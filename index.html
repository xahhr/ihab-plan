<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ØªØ¹Ø§ÙÙŠ 63 â€“ Ø´ØºØ§Ù„ 100%</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
body{font-family:'Cairo',sans-serif;background:#f8f9fa;color:#222;margin:0;line-height:1.6}
header{background:#fff;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.1);position:sticky;top:0;z-index:10}
h1{font-size:24px;margin:0;background:linear-gradient(90deg,#2ecc71,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.wrap{max-width:1200px;margin:auto;padding:15px}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
.card{grid-column:span 12;background:#fff;border-radius:16px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,.08)}
@media(min-width:900px){.half{grid-column:span 6}}
.btn{padding:11px 18px;border:none;border-radius:12px;cursor:pointer;margin:4px;font-size:15px;font-weight:600}
.btn.a{background:#2ecc71;color:#fff}
.btn.w{background:#f39c12;color:#fff}
.pill{padding:7px 15px;border-radius:30px;background:#e8f5e9;font-size:14px}
.bar{height:12px;background:#eee;border-radius:6px;overflow:hidden;margin:12px 0}
.bar span{display:block;height:100%;background:linear-gradient(90deg,#3498db,#2ecc71);transition:.6s}
.table{width:100%;border-collapse:collapse;margin:20px 0}
.table th{background:#f0f8ff;padding:14px}
.table td{padding:12px;text-align:center;border-bottom:1px solid #eee}
.tip{background:#e8f5ff;padding:18px;border-radius:12px;border-right:6px solid #3498db;margin:15px 0;font-size:16px}
.mood{padding:14px 22px;border-radius:30px;background:#f0f0f0;cursor:pointer;transition:.3s;font-size:20px}
.mood.active{background:#d5f5e3;border:3px solid #2ecc71}
#chart{height:240px !important}
dialog{background:#fff;padding:30px;border-radius:16px;border:none;box-shadow:0 15px 50px rgba(0,0,0,.4);max-width:90%;width:550px}
dialog::backdrop{background:#000000cc}
input[type=number]{padding:10px;border-radius:8px;border:1px solid #ccc;width:100px}
</style>
</head>
<body>

<header>
  <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px">
    <h1>ØªØ¹Ø§ÙÙŠ 63 ğŸŒ¿ â€“ Ù…Ù† 15 Ù…Ø¬Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø±ÙŠØ©</h1>
    <div>
      <button class="btn" id="openInv">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ğŸ“¦</button>
      <button class="btn" id="prevDay">â¬… Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
      <button class="btn" id="nextDay">Ø§Ù„ØªØ§Ù„ÙŠ â¡</button>
      <button class="btn w" id="resetStart">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ğŸ“…</button>
      <button class="btn a" id="saveDay">Ø­ÙØ¸ Ø§Ù„ÙŠÙˆÙ… âœ…</button>
    </div>
  </div>
  <div style="margin-top:15px;display:flex;gap:12px;flex-wrap:wrap;align-items:center">
    <span class="pill">Ø¨Ø¯Ø¡: <b id="startDateLabel"></b></span>
    <span class="pill">ÙŠÙˆÙ… <b id="dayIdxLabel">1</b>/63</span>
    <span class="pill">Ø£Ø³Ø¨ÙˆØ¹ <b id="weekLabel">1</b></span>
    <span class="pill" style="background:#d5f5e3">ØªÙ‚Ø¯Ù… <b id="progressText">0%</b></span>
    <div class="bar" style="flex:1"><span id="progressBar" style="width:0%"></span></div>
  </div>
</header>

<div class="wrap"><div class="grid">

  <div class="card"><h3>Ù…Ù†Ø­Ù†Ù‰ Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨ ğŸ“‰</h3><canvas id="chart"></canvas></div>

  <div class="card"><h3>Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… ğŸ¯</h3><p id="targetsText" style="font-size:20px;font-weight:700"></p></div>

  <div class="card">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</h3>
    <table class="table">
      <tr><th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th><th>Ø§Ù„Ù‡Ø¯Ù</th><th>Ø£ÙØ®Ø°</th></tr>
      <tr><td>Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†</td><td id="t_eso">15</td><td><input type="number" step="0.5" data-k="eso"></td></tr>
      <tr><td>Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†</td><td id="t_gab">2200</td><td><input type="number" step="100" data-k="gab"></td></tr>
      <tr><td>Ø£Ø±Ù…ÙˆØ¯Ø§ÙÙŠÙ†ÙŠÙ„</td><td id="t_arm">650</td><td><input type="number" step="50" data-k="arm"></td></tr>
      <tr><td>ÙƒØ§ÙÙŠÙŠÙ† â‰¤</td><td id="t_caf">350</td><td><input type="number" step="10" data-k="caf"></td></tr>
    </table>
  </div>

  <div class="card"><h3>Ù†ØµÙŠØ­Ø© Ø§Ù„ÙŠÙˆÙ… ğŸ’¡</h3><div id="dailyTip" class="tip"></div></div>

  <div class="card half">
    <h3>Ù…Ø²Ø§Ø¬ÙŠ</h3>
    <div style="display:flex;gap:15px;justify-content:center;margin:25px 0">
      <span class="mood" onclick="setMood(1)">ğŸ˜”</span>
      <span class="mood" onclick="setMood(2)">ğŸ˜°</span>
      <span class="mood active" onclick="setMood(3)">ğŸ˜</span>
      <span class="mood" onclick="setMood(4)">ğŸ™‚</span>
      <span class="mood" onclick="setMood(5)">ğŸ˜</span>
    </div>
    <textarea id="notes" rows="5" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…â€¦"></textarea>
  </div>

  <div class="card">
    <h3>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ ğŸ“¦</h3>
    <table class="table" id="invTable"><tbody></tbody></table>
  </div>

</div></div>

<dialog id="invDlg">
  <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
  <div id="invForm"></div>
  <div style="margin-top:25px;text-align:left">
    <button class="btn" style="background:#e74c3c" onclick="document.getElementById('invDlg').close()">Ø¥Ù„ØºØ§Ø¡</button>
    <button class="btn a" id="saveInv">Ø­ÙØ¸ âœ…</button>
  </div>
</dialog>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const TOTAL_DAYS = 63;
const LS_START = "t63_start";
const LS_DATA = "t63_data";
const LS_INV = "t63_inv";
let currentDay = 1, currentMood = 3, chart = null;

const targets = {
  eso: [0,15,15,15,15,15,15,15,14,14,14,14,14,14,14,14,14,14,14,14,12,12,12,12,12,12,12,10,10,10,10,10,10,10,8,8,8,8,8,8,8,6,6,6,6,6,6,6,4,4,4,4,4,4,4,2,2,2,1,1,1,0],
  gab: [0,2200,2200,2200,2200,2200,2200,2200,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,1800,1800,1800,1800,1800,1600,1600,1600,1600,1600,1600,1600,1400,1400,1400,1400,1400,1400,1400,1200,1200,1200,1200,1200,1200,1200,1000,1000,1000,1000,1000,1000,1000,800,800,800,800,800,800,800,600,600,600,300,300,300,0],
  arm: [0,650,650,650,650,650,650,650,600,600,600,600,600,600,600,600,600,600,600,600,550,550,550,550,550,500,500,500,500,500,500,500,400,400,400,400,400,400,400,300,300,300,300,300,300,300,200,200,200,200,200,200,200,100,100,100,100,100,100,100,50,50,50,0,0,0,0],
  caf: [0,350,350,350,350,350,350,350,300,300,300,300,300,300,300,300,300,300,300,300,250,250,250,250,250,200,200,200,200,200,200,200,150,150,150,150,150,150,150,100,100,100,100,100,100,100,75,75,75,75,75,75,75,50,50,50,50,50,50,50,30,30,30,10,10,10,0]
};

const drugInfo = {
  eso: {name:"Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†", mg:3, tabsPerBox:30},
  gab: {name:"Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†", mg:800, tabsPerBox:30},
  arm: {name:"Ø£Ø±Ù…ÙˆØ¯Ø§ÙÙŠÙ†ÙŠÙ„", mg:150, tabsPerBox:30}
};

const tips = ["Ø§Ø´Ø±Ø¨ 4-5 Ù„ØªØ± Ù…Ø§Ø¡","Ù…ØºÙ†ÙŠØ³ÙŠÙˆÙ… Ø¬Ù„Ø§ÙŠØ³ÙŠÙ†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…","20-30 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø´ÙŠ ÙŠÙˆÙ…ÙŠÙ‹Ø§","Ù„Ø§ ÙƒØ§ÙÙŠÙŠÙ† Ø¨Ø¹Ø¯ 2 Ø¸Ù‡Ø±Ù‹Ø§","Ø­Ù…Ø§Ù… Ø¯Ø§ÙØ¦ + Ù…Ù„Ø­ Ø¥Ø¨Ø³ÙˆÙ…","ØªÙ†ÙØ³ 4-7-8","Ø£ÙˆÙ…ÙŠØ¬Ø§-3 Ø¹Ø§Ù„ÙŠ EPA","Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù†ÙˆÙ… Ø«Ø§Ø¨ØªØ©","Ù„-Ø«ÙŠØ§Ù†ÙŠÙ† 200-400 Ù…Ø¬Ù…","ÙƒÙˆÙŠØªØ§Ø¨ÙƒØ³ 25 ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±ÙˆØ±Ø© Ø§Ù„Ù‚ØµÙˆÙ‰"];

function getStartDate() {
  let s = localStorage.getItem(LS_START);
  if (!s) {
    let d = new Date(); d.setHours(0,0,0,0);
    localStorage.setItem(LS_START, d.toISOString());
    s = d.toISOString();
  }
  return new Date(s);
}

function getCurrentDay() {
  const diff = Date.now() - getStartDate().getTime();
  const day = Math.floor(diff / 86400000) + 1;
  return Math.min(TOTAL_DAYS, Math.max(1, day));
}

function loadDayData(d) {
  const a = JSON.parse(localStorage.getItem(LS_DATA) || "{}");
  return a[d] || {med:{}, mood:3, notes:""};
}

function saveDayData(d, o) {
  const a = JSON.parse(localStorage.getItem(LS_DATA) || "{}");
  a[d] = o;
  localStorage.setItem(LS_DATA, JSON.stringify(a));
}

function renderChart() {
  if (chart) chart.destroy();
  chart = new Chart(document.getElementById('chart'), {
    type: 'line',
    data: {
      labels: Array.from({length:TOTAL_DAYS},(_,i)=>i+1),
      datasets: [
        {label:'Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†', data:targets.eso.slice(1), borderColor:'#e74c3c', tension:0.4},
        {label:'Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ† Ã·100', data:targets.gab.slice(1).map(x=>x/100), borderColor:'#f39c12', tension:0.4},
        {label:'Ø£Ø±Ù…ÙˆØ¯Ø§ÙÙŠÙ†ÙŠÙ„', data:targets.arm.slice(1), borderColor:'#3498db', tension:0.4}
      ]
    },
    options: {plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}, maintainAspectRatio:false}
  });
}

function renderInventory() {
  let inv = JSON.parse(localStorage.getItem(LS_INV) || "{}");
  if (Object.keys(inv).length === 0) {
    inv = {eso:{boxes:6,loose:0}, gab:{boxes:4,loose:0}, arm:{boxes:3,loose:0}};
    localStorage.setItem(LS_INV, JSON.stringify(inv));
  }
  const tbody = document.querySelector("#invTable tbody");
  tbody.innerHTML = "";
  Object.keys(drugInfo).forEach(k => {
    const i = drugInfo[k];
    const cur = inv[k];
    const totalTabs = cur.boxes * i.tabsPerBox + cur.loose;
    const totalMg = totalTabs * i.mg;
    let needed = 0;
    for (let d = currentDay; d <= TOTAL_DAYS; d++) needed += targets[k][d];
    const daysLeft = needed === 0 ? "âˆ" : Math.floor(totalMg / needed * (TOTAL_DAYS-currentDay+1));
    const tr = document.createElement("tr");
    tr.innerHTML = `<td><b>${i.name}</b></td><td>${totalTabs} Ù‚Ø±Øµ</td><td>${totalMg.toLocaleString()} Ù…Ø¬Ù…</td><td><b>${daysLeft}</b> ÙŠÙˆÙ…</td><td style="font-size:26px">${daysLeft<10 && daysLeft!=="âˆ" ? "âš ï¸" : "âœ…"}</td>`;
    tbody.appendChild(tr);
  });
}

function render() {
  currentDay = getCurrentDay();

  document.getElementById("dayIdxLabel").textContent = currentDay;
  document.getElementById("weekLabel").textContent = Math.ceil(currentDay/7);
  document.getElementById("progressText").textContent = Math.round((currentDay-1)/(TOTAL_DAYS-1)*100) + "%";
  document.getElementById("progressBar").style.width = (currentDay-1)/(TOTAL_DAYS-1)*100 + "%";
  document.getElementById("startDateLabel").textContent = getStartDate().toLocaleDateString('ar-EG');

  document.getElementById("t_eso").textContent = targets.eso[currentDay];
  document.getElementById("t_gab").textContent = targets.gab[currentDay];
  document.getElementById("t_arm").textContent = targets.arm[currentDay];
  document.getElementById("t_caf").textContent = targets.caf[currentDay];

  document.getElementById("targetsText").innerHTML = `Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ† <b>${targets.eso[currentDay]}</b> Ù…Ø¬Ù… â€¢ Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ† <b>${targets.gab[currentDay]}</b> â€¢ Ø£Ø±Ù…ÙˆØ¯Ø§ÙÙŠÙ†ÙŠÙ„ <b>${targets.arm[currentDay]}</b> â€¢ ÙƒØ§ÙÙŠÙŠÙ† â‰¤ <b>${targets.caf[currentDay]}</b>`;

  document.getElementById("dailyTip").innerHTML = "ğŸ’¡ <b>Ù†ØµÙŠØ­Ø© Ø§Ù„ÙŠÙˆÙ…:</b><br>" + tips[(currentDay-1) % tips.length];

  const data = loadDayData(currentDay);
  ["eso","gab","arm","caf"].forEach(k => {
    document.querySelector(`input[data-k="${k}"]`).value = data.med[k] || "";
  });
  document.getElementById("notes").value = data.notes || "";
  setMood(data.mood || 3);

  renderChart();
  renderInventory();
}

function setMood(m) {
  currentMood = m;
  document.querySelectorAll('.mood').forEach((e,i) => e.classList.toggle('active', i===m-1));
}

document.getElementById("saveDay").onclick = () => {
  const data = {med:{}, mood:currentMood, notes:document.getElementById("notes").value};
  ["eso","gab","arm","caf"].forEach(k => {
    let v = document.querySelector(`input[data-k="${k}"]`).value;
    data.med[k] = v==="" ? null : Number(v);
  });
  saveDayData(currentDay, data);
  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
};

document.getElementById("prevDay").onclick = () => { currentDay = Math.max(1, currentDay-1); render(); };
document.getElementById("nextDay").onclick = () => { currentDay = Math.min(TOTAL_DAYS, currentDay+1); render(); };

document.getElementById("resetStart").onclick = () => {
  const s = prompt("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (YYYY-MM-DD)", getStartDate().toISOString().slice(0,10));
  if (s) {
    localStorage.setItem(LS_START, new Date(s+"T00:00").toISOString());
    render();
  }
};

document.getElementById("openInv").onclick = () => {
  const inv = JSON.parse(localStorage.getItem(LS_INV) || "{}");
  let html = "";
  Object.keys(drugInfo).forEach(k => {
    const i = drugInfo[k];
    const cur = inv[k] || {boxes:0, loose:0};
    html += `<div style="margin:20px 0;padding:20px;background:#f8f9fa;border-radius:12px">
      <h4>${i.name} (${i.mg} Ù…Ø¬Ù… â€“ ${i.tabsPerBox} Ù‚Ø±Øµ/Ø¹Ù„Ø¨Ø©)</h4>
      Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù„Ø¨: <input type="number" value="${cur.boxes}" data-k="${k}" data-f="boxes"><br><br>
      Ø£Ù‚Ø±Ø§Øµ Ù…ÙØ±Ø¯Ø©: <input type="number" value="${cur.loose}" data-k="${k}" data-f="loose">
    </div>`;
  });
  document.getElementById("invForm").innerHTML = html;
  document.getElementById("invDlg").showModal();
};

document.getElementById("saveInv").onclick = () => {
  const inv = {};
  document.querySelectorAll("#invForm input").forEach(i => {
    const k = i.dataset.k;
    const f = i.dataset.f;
    if (!inv[k]) inv[k] = {};
    inv[k][f] = Number(i.value) || 0;
  });
  localStorage.setItem(LS_INV, JSON.stringify(inv));
  document.getElementById("invDlg").close();
  renderInventory();
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† âœ…");
};

render();
setInterval(() => { if (getCurrentDay() !== currentDay) render(); }, 60000);
</script>
</body>
</html>